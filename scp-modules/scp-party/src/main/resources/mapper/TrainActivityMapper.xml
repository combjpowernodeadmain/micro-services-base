<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bjzhianjia.scp.party.mapper.TrainActivityMapper">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.bjzhianjia.scp.party.entity.TrainActivity" id="trainActivityMap">
        <result property="id" column="id"/>
        <result property="trainActivityTitle" column="train_activity_title"/>
        <result property="trainActivityContent" column="train_activity_content"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="isWhole" column="is_whole"/>
        <result property="crtTime" column="crt_time"/>
        <result property="crtUserId" column="crt_user_id"/>
        <result property="crtUserName" column="crt_user_name"/>
        <result property="updTime" column="upd_time"/>
        <result property="updUserId" column="upd_user_id"/>
        <result property="updUserName" column="upd_user_name"/>
    </resultMap>
    <!-- 获取全部优培批次简讯 -->
    <select id="selectTrainActivitys" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        id,
        trainActivityTitle,
        endDate,
        startDate,
        isWhole,
        crtTime,
        group_concat(trainGroupName) trainGroupName
        FROM
        (
        SELECT
        ta.id id,
        ta.train_activity_title trainActivityTitle,
        ta.end_date endDate,
        ta.start_date startDate,
        ta.is_whole isWhole,
        ta.crt_time crtTime,
        tg.train_group_name trainGroupName
        FROM
        train_activity ta
        LEFT JOIN train_activity_group tag ON tag.train_activity_id = ta.id
        LEFT JOIN train_group tg ON tg.id = tag.train_group_id
        WHERE
        ta.is_deleted = '0'
        AND ta.train_id=#{trainId}
        <if test="trainActivityTitle != null and trainActivityTitle != '' ">
            <bind name="activityTitle" value="'%'+trainActivityTitle+'%'"/>
            AND ta.train_activity_title like #{activityTitle}
        </if>
        <!-- 开始和结束日期必须填项 -->
        <if test="startDate != '' and endDate != '' ">
            <![CDATA[AND (ta.start_date <= #{endDate}AND ta.end_date >= #{startDate})]]>
        </if>
        ) temp
        GROUP BY
        id,
        trainActivityTitle,
        endDate,
        startDate,
        isWhole,
        crtTime
        ORDER BY
        crtTime DESC
    </select>
</mapper>