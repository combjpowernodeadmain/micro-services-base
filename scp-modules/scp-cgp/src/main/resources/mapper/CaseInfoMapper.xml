<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bjzhianjia.scp.cgp.mapper.CaseInfoMapper">

	<!-- 可根据自己的需求，是否要使用 -->
	<resultMap type="com.bjzhianjia.scp.cgp.entity.CaseInfo"
		id="caseInfoMap">
		<result property="id" column="id" />
		<result property="sourceType" column="source_type" />
		<result property="sourceCode" column="source_code" />
		<result property="caseCode" column="case_code" />
		<result property="caseTitle" column="case_title" />
		<result property="caseDesc" column="case_desc" />
		<result property="regulaObjList" column="regula_obj_list" />
		<result property="concernedPerson" column="concerned_person" />
		<result property="bizList" column="biz_list" />
		<result property="eventTypeList" column="event_type_list" />
		<result property="grid" column="grid" />
		<result property="occurAddr" column="occur_addr" />
		<result property="mapInfo" column="map_info" />
		<result property="checkIsExist" column="check_is_exist" />
		<result property="checkTime" column="check_time" />
		<result property="checkPerson" column="check_person" />
		<result property="checkOpinion" column="check_opinion" />
		<result property="checkPic" column="check_pic" />
		<result property="checkVideo" column="check_video" />
		<result property="deadLine" column="dead_line" />
		<result property="executeDept" column="execute_dept" />
		<result property="requirements" column="requirements" />
		<result property="approveInfo" column="approve_info" />
		<result property="finishCheckIsExist"
			column="finish_check_is_exist" />
		<result property="finishCheckTime" column="finish_check_time" />
		<result property="finishCheckPerson"
			column="finish_check_person" />
		<result property="finishCheckOpinion"
			column="finish_check_opinion" />
		<result property="finishCheckPic" column="finish_check_pic" />
		<result property="finishCheckVideo" column="finish_check_video" />
		<result property="finishPerson" column="finish_person" />
		<result property="finishTime" column="finish_time" />
		<result property="finishDesc" column="finish_desc" />
		<result property="replyPerson" column="reply_person" />
		<result property="replyTime" column="reply_time" />
		<result property="replyDesc" column="reply_desc" />
		<result property="isDeleted" column="is_deleted" />
		<result property="crtTime" column="crt_time" />
		<result property="crtUserId" column="crt_user_id" />
		<result property="crtUserName" column="crt_user_name" />
		<result property="updTime" column="upd_time" />
		<result property="updUserId" column="upd_user_id" />
		<result property="updUserName" column="upd_user_name" />
		<result property="tenantId" column="tenant_id" />
		<result property="deptId" column="dept_id" />
	</resultMap>

	<!-- 事件来源分布统计 -->
	<select id="getStatisEventSource" resultType="java.util.Map">
		SELECT
		source_type as sourceType,
		count(*) as count
		FROM
		case_info
		WHERE
			<include refid="isParam" />
		GROUP BY
		source_type
	</select>

	<!-- 事件量趋势统计 -->
	<select id="getStatisCaseInfo" resultType="java.util.Map">
		SELECT
		YEAR (crt_time) AS year,
		MONTH (crt_time) AS month,
		case_level AS caseLevel,
		count(*) count
		FROM
		case_info
		WHERE
			<include refid="isParam" />
		GROUP BY
		YEAR (crt_time),
		MONTH (crt_time),
		case_level
	</select>

	<!-- 事件查询参数 -->
	<sql id="isParam">
		<!-- 未删除 -->
		is_deleted=0
		<!-- 业务线条 -->
		<if test="caseInfo.bizList != null and caseInfo.bizList != ''">
			and biz_list=#{caseInfo.bizList}
		</if>
		<!-- 事件类别 -->
		<if
			test="caseInfo.eventTypeList != null and caseInfo.eventTypeList != ''">
			and event_type_list=#{caseInfo.eventTypeList}
		</if>
		<!-- 网格范围（网格id） -->
		<if test="caseInfo.grid != null and caseInfo.grid != ''">
			and grid=#{caseInfo.grid}
		</if>
		<!-- 事件来源 -->
		<if
			test="caseInfo.sourceType != null and caseInfo.sourceType != ''">
			and source_type=#{caseInfo.sourceType}
		</if>
		<!-- 事件级别 -->
		<if test="caseInfo.caseLevel != null and caseInfo.caseLevel != ''">
			and case_level=#{caseInfo.caseLevel}
		</if>
		<!-- 日期范围（开始时间和结束时间） -->
		<if test="startTime !=null and startTime!='' ">
			<if test="endTime !=null and endTime!='' ">
					<![CDATA[
					and #{startTime}<=crt_time and crt_time <= #{endTime}
					]]>
			</if>
		</if>
	</sql>
</mapper>