webpackJsonp([30],{Hp2k:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),n=a.n(r),i=a("yMJ4"),l=a("NYxO"),s=a("yBzI"),d={components:{"depart-user":function(){return a.e(3).then(a.bind(null,"nKU/"))},"depart-position":function(){return a.e(67).then(a.bind(null,"j03T"))}},watch:{filterText:function(e){this.$refs.mainTree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleTableRowCreate:function(){void 0===this.currentTreeNodeId?this.$notify({title:"提示",message:"请先选择部门节点！",type:"warning",duration:2e3}):this.dialogUserVisible=!0},handleTableRowDelete:function(e){var t=this;this.$confirm("此操作将永久删除用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(i.d)({departId:t.currentTreeNodeId,userId:e.id}).then(function(){t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3});var a=t.childTableData.indexOf(e);t.childTableData.splice(a,1)})})},handlerTableRowFilter:function(){var e=this;this.listTableQuery.departId=this.currentTreeNodeId;var t={departId:this.currentTreeNodeId,name:this.listTableQuery.name};Object(i.g)(t).then(function(t){e.childTableData=t.data.rows})},handlerMainTreeForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;Object(i.h)(t.mainTreeForm.id,t.mainTreeForm).then(function(){t.editTreeFormFlag=!1,t.initmainTreeData(),t.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3})})})},append:function(e,t){var a=this,r={};void 0===t?((t={}).code=(new Date).getTime(),t.id="-1",Object(i.a)({name:"根节点需修改",code:t.code,parentId:t.id}).then(function(){a.initmainTreeData()})):Object(i.a)({name:"子节点",code:(new Date).getTime()+"_tmp",parentId:t.id}).then(function(e){var n={id:(r=e.data).id,label:r.name,children:[]};t.children||a.$set(t,"children",[]),t.children.push(n)}),this.$refs.mainTree.setCurrentKey(t.id)},remove:function(e,t){var a=this;if(t.children.length>0)this.$notify({title:"失败",message:"删除失败，该部门有其他子部门！",type:"warning",duration:2e3});else{var r={departId:this.currentTreeNodeId};Object(i.g)(r).then(function(r){a.childTableData=r.data.rows,a.childTableData.length>0?a.$notify({title:"失败",message:"删除失败，部门存在用户！",type:"warning",duration:2e3}):(Object(i.c)(t.id).then(function(){a.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3});var r=e.parent,n=r.data.children||r.data,i=n.findIndex(function(e){return e.id===t.id});n.splice(i,1)}),a.$refs.mainTree.setCurrentKey(t.id))})}},edit:function(e,t){var a=this;this.editTreeFormFlag=!0,Object(i.e)(t.id).then(function(e){a.mainTreeForm=e.data}),this.$refs.mainTree.setCurrentKey(t.id)},resetMainTreeForm:function(){this.mainTreeForm={code:"",name:""}},renderContent:function(e,t){var a=this,r=t.node,n=t.data;return e("span",{style:"flex: 1; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px;"},[e("span",[e("span",[r.label])]),e("span",[this.departManager_btn_edit?e("el-button",{style:"font-size: 12px;",attrs:{type:"text"},on:{click:function(){return a.edit(r,n)}}},[e("i",{class:"el-icon-edit"})]):e("span"),this.departManager_btn_add?e("el-button",{style:"font-size: 12px;",attrs:{type:"text"},on:{click:function(){return a.append(r,n)}}},[e("i",{class:"el-icon-circle-plus-outline"})]):e("span"),this.departManager_btn_del?e("el-button",{style:"font-size: 12px;",attrs:{type:"text"},on:{click:function(){return a.remove(r,n)}}},[e("i",{class:"el-icon-delete"})]):e("span")])])},initmainTreeData:function(){var e=this;Object(i.f)().then(function(t){e.mainTreeData=t})},getTreeNodeData:function(e){var t=this;this.currentTreeNodeId=e.id,this.currentTreeNode=e;var a={departId:this.currentTreeNodeId};Object(i.g)(a).then(function(e){t.childTableData=e.data.rows}),this.$refs.positionManager.getList(e.id)},closeUserDialog:function(e){var t=this;this.dialogUserVisible=!1;for(var a=[],r=!1,n=0;n<e.length;n++){r=!0;for(var l=0;l<this.childTableData.length;l++)this.childTableData[l].id===e[n].id&&(r=!1);r&&(this.childTableData.push(e[n]),a.push(e[n].id))}console.log(this.$refs.departUser),this.$refs.departUser.clear(),Object(i.b)({departId:this.currentTreeNodeId,userIds:a.join()}).then(function(){t.$notify({title:"成功",message:"保存成功",type:"success",duration:2e3})})}},created:function(){var e=this;this.initmainTreeData(),this.departManager_btn_edit=this.elements["departManager:btn_edit"],this.departManager_btn_del=this.elements["departManager:btn_del"],this.departManager_btn_add=this.elements["departManager:btn_add"],this.departManager_btn_user_add=this.elements["departManager:btn_user_add"],this.departManager_btn_user_del=this.elements["departManager:btn_user_del"],Object(s.c)("org_depart").then(function(t){e.departTypeOptions=t.data.rows})},computed:n()({},Object(l.b)(["elements"])),data:function(){return{dialogUserVisible:!1,departTypeOptions:[],departManager_btn_edit:!1,departManager_btn_del:!1,departManager_btn_add:!1,departManager_btn_user_add:!1,departManager_btn_user_del:!1,filterText:"",editTreeFormFlag:!1,currentTreeNodeId:void 0,currentTreeNode:{},mainTreeForm:{code:"",name:""},listTableQuery:{name:void 0,departId:void 0},mainTreeFormRules:{code:[{required:!0,message:"请输入编码",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入目录名",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}]},mainTreeData:[],defaultProps:{children:"children",label:"label"},childTableData:[]}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container calendar-list-container"},[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"filter-container"},[a("el-button-group",[e.departManager_btn_add?a("el-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.append}},[e._v("初始化")]):e._e()],1)],1),e._v(" "),a("div",{staticClass:"grid-content bg-purple",staticStyle:{"margin-right":"10px"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("组织架构")])]),e._v(" "),a("div",[a("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"mainTree",staticClass:"filter-tree",attrs:{"node-key":"id",data:e.mainTreeData,props:e.defaultProps,"default-expand-all":"","expand-on-click-node":!1,"filter-node-method":e.filterNode,"highlight-current":"","render-content":e.renderContent},on:{"node-click":e.getTreeNodeData}})],1)])],1)]),e._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:16}},[a("div",{staticClass:"grid-content bg-purple-light"},[e.editTreeFormFlag?e._e():a("el-card",{staticClass:"box-card",staticStyle:{height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("组织相关")])]),e._v(" "),a("div",[a("el-tabs",{attrs:{value:"first"}},[a("el-tab-pane",{attrs:{label:"用户管理",name:"first"}},[a("div",{staticClass:"filter-container"},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"标签或code"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handlerTableRowFilter(t)}},model:{value:e.listTableQuery.name,callback:function(t){e.$set(e.listTableQuery,"name",t)},expression:"listTableQuery.name"}}),e._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"search"},on:{click:e.handlerTableRowFilter}},[e._v("搜索")]),e._v(" "),e.departManager_btn_user_add?a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.handleTableRowCreate}},[e._v("添加用户")]):e._e()],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.childTableData,border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{width:"200",align:"center",label:"姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"110",align:"center",label:"账户"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.username))])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"110",align:"center",label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.sex))])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"300",align:"center",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.description))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.departManager_btn_user_del?a("el-button",{staticStyle:{color:"red"},attrs:{size:"small",type:"text"},on:{click:function(a){e.handleTableRowDelete(t.row)}}},[a("i",{staticClass:"el-icon-delete"})]):e._e()]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"岗位管理",name:"second"}},[a("depart-position",{ref:"positionManager",attrs:{departId:e.currentTreeNodeId}})],1)],1)],1)]),e._v(" "),e.editTreeFormFlag?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("部门编辑")])]),e._v(" "),a("div",[a("el-form",{ref:"mainTreeForm",staticClass:"demo-ruleForm",attrs:{model:e.mainTreeForm,"status-icon":"",rules:e.mainTreeFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"编码",prop:"code"}},[a("el-input",{attrs:{placeholder:"请输入编码"},model:{value:e.mainTreeForm.code,callback:function(t){e.$set(e.mainTreeForm,"code",t)},expression:"mainTreeForm.code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门名",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入部门名"},model:{value:e.mainTreeForm.name,callback:function(t){e.$set(e.mainTreeForm,"name",t)},expression:"mainTreeForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门类型"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择部门类型"},model:{value:e.mainTreeForm.type,callback:function(t){e.$set(e.mainTreeForm,"type",t)},expression:"mainTreeForm.type"}},e._l(e.departTypeOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.labelDefault,value:e.value}})}))],1),e._v(" "),a("el-form-item",[e.departManager_btn_edit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handlerMainTreeForm("mainTreeForm")}}},[e._v("提交")]):e._e(),e._v(" "),a("el-button",{on:{click:function(t){e.editTreeFormFlag=!1}}},[e._v("取消")])],1)],1)],1)]):e._e()],1)])],1),e._v(" "),e.departManager_btn_add?a("el-dialog",{attrs:{title:"添加用户",visible:e.dialogUserVisible},on:{"update:visible":function(t){e.dialogUserVisible=t}}},[a("depart-user",{ref:"departUser",on:{closeUserDialog:e.closeUserDialog}})],1):e._e()],1)},staticRenderFns:[]},c=a("VU/8")(d,o,!1,null,null,null);t.default=c.exports}});